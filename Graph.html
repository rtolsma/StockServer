<!DOCTYPE html>
<meta charset="utf-8">
<style>//general style for the graphs
    body {
        font: 10px sans-serif;
    }
    
    text {
        fill: #000;
    }
    
    button {
        position: absolute;
        right: 20px;
        top: 440px;
        display: none;
    }
    
    path.candle {
        stroke: #000000;
    }
    
    path.candle.body {
        stroke-width: 0;
    }
    
    path.candle.up {
        fill: #00AA00;
        stroke: #00AA00;
    }
    
    path.candle.down {
        fill: #FF0000;
        stroke: #FF0000;
    }
</style>

<body>
    <script src="d3.v4.min.js"></script>
    <script src="techan.min.js"></script>
    <script>
        var data = ["hi", "bye"];//place holder for the datta that will be passed
        var graph1 = new Graph(data);
        graph1.plot();//plots graphs orginaly
        graph1.plot();
        graph1.plot();

        function Graph(data) {//makes an object of graph
            this.data = data;
            this.plot = function () {//function that plots the orginal csv file
                var margin = {
                        top: 20
                        , right: 20
                        , bottom: 30
                        , left: 50
                    }
                    , width = screen.width - margin.left - margin.right - 20
                    , height = (screen.height / 4) - margin.top - margin.bottom;//sets up the width an height of graph
                var parseDate = d3.timeParse("%d-%b-%y");
                var x = techan.scale.financetime().range([0, width]);
                var y = d3.scaleLinear().range([height, 0]);
                var candlestick = techan.plot.candlestick().xScale(x).yScale(y);
                var xAxis = d3.axisBottom().scale(x);
                var yAxis = d3.axisLeft().scale(y);
                var svg = d3.select("body").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                d3.csv("data.csv", function (error, data) {//gets the datta from the csv file
                    var accessor = candlestick.accessor();
                    data = data.slice(0, 200).map(function (d) {
                        return {
                            date: parseDate(d.Date)
                            , open: +d.Open
                            , high: +d.High
                            , low: +d.Low
                            , close: +d.Close
                            , volume: +d.Volume
                        };
                    }).sort(function (a, b) {
                        return d3.ascending(accessor.d(a), accessor.d(b));
                    });
                    svg.append("g").attr("class", "candlestick");
                    svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")");
                    svg.append("g").attr("class", "y axis").append("text").attr("transform", "rotate(-90)").attr("y", 6).attr("dy", ".71em").style("text-anchor", "end").text("Price ($)");
                    // Data to display initially
                    draw(data.slice(0, data.length - 20));
                    // Only want this button to be active if the data has loaded
                });

                function draw(data) {//draw the intial data
                    x.domain(data.map(candlestick.accessor().d));
                    y.domain(techan.scale.plot.ohlc(data, candlestick.accessor()).domain());
                    svg.selectAll("g.candlestick").datum(data).call(candlestick);
                    svg.selectAll("g.x.axis").call(xAxis);
                    svg.selectAll("g.y.axis").call(yAxis);
                }
            }
            this.update = function () {}//to be implemented for the updating of the graphs
        }
    </script>
</body>
